<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
        <style>
            body {
                display: grid;
                height: calc(100vh - 16px);
                width: calc(100vw - 16px);
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
            }

            #menu {
                grid-column: 1;
                grid-row: 1;
                height: 100%;
                width: 100%;
                margin: 0px;
                padding: 5px;
                list-style: none;
                font-size: 1.5em;
            }

            #menu li {
                display: inline-block;
            }

            #menu li #file-input {
                display: none;
            }

            #content {
                grid-column: 1;
                grid-row: 2;
            }
        </style>
    </head>
    <body>
        <ul id="menu">
            <li id="new" title="New Character">&#x1F4C4;</li>
            <li id="open" title="Load Character">&#x1F4C2;</li>
            <li id="save" title="Save Character">&#x1F4BE;</li>
        </ul>
        <div id="content"></div>
    </body>

    <!-- Build a Character Object -->

    <script>
        class Character {
            _name;
            _race;
            _classes;
            _characterLevel = 0;
            _abilityScores;

            get Name() { return this._name; }
            set Name(name) { this._name = name; }

            get Race() { return this._race; }
            set Race(race) { this._race = race };

            get Classes() { return this._classes; }
            set Classes(obj) { this._classes = obj; }

            get CharacterLevel() { return this._characterLevel; }
            set CharacterLevel(level) { this._characterLevel = level; }

            get AbilityScores() { return this._abilityScores; }
            set AbilityScores(obj) { this._abilityScores = obj };

            // Methods

            TotalLevels() {
                let total = 0;

                for (let key in this._classes) {
                    total = total + this._classes[key];
                }

                return total;
            }

            Modifer(stat) {
                let modifier = Math.floor((stat - 10) / 2);

                if (modifier > 0) {
                    return `+${modifier}`;
                } else {
                    return modfier;
                }
            }

            constructor(json) {
                if(json) {
                    this.Name = json["Name"];
                    this.Race = json["Race"];
                    this.Classes = new ClassLevels(json["Classes"]);
                    this.CharacterLevel = this.TotalLevels();
                    this.AbilityScores = new AbilityScores(json["Ability Scores"]);
                }
            }
        }

        class ClassLevels {
            // Fields

            _artificer = 0;
            _barbarian = 0;
            _bard = 0;
            _cleric = 0;
            _fighter = 0;
            _monk = 0;
            _paladin = 0;
            _ranger = 0;
            _rouge = 0;
            _sorcerer = 0;
            _warlock = 0;
            _wizard = 0;

            // Properties

            get Artificer() { return this._artificer; }
            set Artificer(int) { this._artificer = int; }

            get Barbarian() { return this._barbarian; }
            set Barbarian(int) { this._barbarian = int; } 

            get Bard() { return this._bard; }
            set Bard(int) { this._bard = int; } 

            get Cleric() { return this._cleric; }
            set Cleric(int) { this._cleric = int; } 

            get Fighter() { return this._fighter; }
            set Fighter(int) { this._fighter = int; } 

            get Monk() { return this._monk; }
            set Monk(int) { this._monk = int; } 

            get Paladin() { return this._paladin; }
            set Paladin(int) { this._paladin = int; } 

            get Ranger() { return this._ranger; }
            set Ranger(int) { this._ranger = int; } 

            get Rouge() { return this._rouge; }
            set Rouge(int) { this._rouge = int; } 

            get Sorcerer() { return this._sorcerer; }
            set Sorcerer(int) { this._sorcerer = int; } 

            get Warlock() { return this._warlock; }
            set Warlock(int) { this._warlock = int; } 

            get Wizard() { return this._wizard; }
            set Wizard(int) { this._wizard = int; } 

            constructor(json) {
                if (json) {
                    this.Artificer = json["Artificer"];
                    this.Barbarian = json["Barbarian"];
                    this.Bard = json["Bard"];
                    this.Cleric = json["Cleric"];
                    this.Fighter = json["Fighter"];
                    this.Monk = json["Monk"];
                    this.Paladin = json["Paladin"];
                    this.Ranger = json["Ranger"];
                    this.Rouge = json["Rouge"];
                    this.Sorcerer = json["Sorcerer"];
                    this.Warlock = json["Warlock"];
                    this.Wizard = json["Wizard"];                    
                }
            }
        }

        class AbilityScores {
            // Fields

            _strength = 0;
            _dexterity = 0;
            _constituion = 0;
            _wisdom = 0;
            _intelligence = 0;
            _charisma = 0;

            // Properties

            get Strength() { return this._strength; }
            set Strength(int) { this._strength = int; }

            get Dexterity() { return this._dexterity; }
            set Dexterity(int) { this._dexterity = int; }

            get Constituion() { return this._constituion; }
            set Constituion(int) { this._constituion = int; }

            get Wisdom() { return this._wisdom; }
            set Wisdom(int) { this._wisdom = int; }

            get Intelligence() { return this._intelligence; }
            set Intelligence(int) { this._intelligence = int; }

            get Charisma() { return this._charisma; }
            set Charisma(int) { this._charisma = int; }

            // Methods

            constructor(json) {
                if (json) {
                    this.Strength = json["Strength"];
                    this.Dexterity = json["Dexterity"];
                    this.Constituion = json["Constitution"];
                    this.Wisdom = json["Wisdom"];
                    this.Intelligence = json["Intelligence"];
                    this.Charisma = json["Charisma"];                    
                }
            }
        }

        class Skills {
            // Fields

            _acrobatics;
            _animalHandling;
            _arcana;
            _athletics;
            _deception;
            _history;
            _insight;
            _intimidation;
            _investigation;
            _medicine;
            _nature;
            _perception;
            _performance;
            _persuasion;
            _religon;
            _sleightofHand;
            _stealth;
            _survival;

            get Acrobatics() { return this._acrobatics };
            set Acrobatics(bool) { this._acrobatics = bool };

            get AnimalHandling() { return this._animalHandling };
            set AnimalHandling(bool) { this._animalHandling = bool };
            
            get Arcana() { return this._arcana };
            set Arcana(bool) { this._arcana = bool };
            
            get Athletics() { return this._athletics };
            set Athletics(bool) { this._athletics = bool };
            
            get Deception() { return this._deception };
            set Deception(bool) { this._deception = bool };
            
            get History() { return this._history };
            set History(bool) { this._history = bool };
            
            get Insight() { return this._insight };
            set Insight(bool) { this._insight = bool };
            
            get Intimidation() { return this._intimidation };
            set Intimidation(bool) { this._intimidation = bool };
            
            get Investigation() { return this._investigation };
            set Investigation(bool) { this._investigation = bool };
            
            get Medicine() { return this._medicine };
            set Medicine(bool) { this._medicine = bool };
            
            get Nature() { return this._nature };
            set Nature(bool) { this._nature = bool };
            
            get Perception() { return this._perception };
            set Perception(bool) { this._perception = bool };
            
            get Performance() { return this._performance };
            set Performance(bool) { this._performance = bool };
            
            get Persuasion() { return this._persuasion };
            set Persuasion(bool) { this._persuasion = bool };
            
            get Religon() { return this._religon };
            set Religon(bool) { this._religon = bool };
            
            get SleightofHand() { return this._sleightofHand };
            set SleightofHand(bool) { this._sleightofHand = bool };
            
            get Stealth() { return this._stealth };
            set Stealth(bool) { this._survival = bool };
            
            get Survival() { return this._survival };
            set Survival(bool) { this._survival = bool };

            constructor(json) {
                if (json) {
                    this.Acrobatics = json["Acrobatics"];
                    this.AnimalHandling = json["Animal Handling"];
                    this.Arcana = json["Arcana"];
                    this.Athletics = json["Athletics"];
                    this.Deception = json["Deception"];
                    this.History = json["History"];
                    this.Insight = json["Insight"];
                    this.Intimidation = json["Intimidation"];
                    this.Investigation = json["Investigation"];
                    this.Medicine = json["Medicine"];
                    this.Nature = json["Nature"];
                    this.Perception = json["Perception"];
                    this.Performance = json["Performance"];
                    this.Persuasion = json["Persuasion"];
                    this.Religon = json["Religon"];
                    this.SleightofHand = json["Sleight of Hand"];
                    this.Stealth = json["Stealth"];
                    this.Survival = json["Survival"];                    
                }
            }
        }

        class SavingThrows {
            // Fields

            _strength = 0;
            _dexterity = 0;
            _constituion = 0;
            _wisdom = 0;
            _intelligence = 0;
            _charisma = 0;

            // Properties

            get Strength() { return this._strength; }
            set Strength(bool) { this._strength = bool; }

            get Dexterity() { return this._dexterity; }
            set Dexterity(bool) { this._dexterity = bool; }

            get Constituion() { return this._constituion; }
            set Constituion(bool) { this._constituion = bool; }

            get Wisdom() { return this._wisdom; }
            set Wisdom(bool) { this._wisdom = bool; }

            get boolelligence() { return this._boolelligence; }
            set boolelligence(bool) { this._boolelligence = bool; }

            get Charisma() { return this._charisma; }
            set Charisma(bool) { this._charisma = bool; }

            // Methods

            constructor(json) {
                if (json) {
                    this.Strength = json["Strength"];
                    this.Dexterity = json["Dexterity"];
                    this.Constituion = json["Constitution"];
                    this.Wisdom = json["Wisdom"];
                    this.Intelligence = json["Intelligence"];
                    this.Charisma = json["Charisma"];                    
                }
            }
        }

        class WeaponProficiencies {
            // Fields
            
            _club;
            _dagger;
            _greatclub;
            _handaxe;
            _javelin;
            _lightHammer;
            _mace;
            _quarterstaff;
            _sickle;
            _spear;
            _unarmedStrike;
            
            _crossbowLight;
            _dart;
            _shortbow;
            _sling;

            _battleaxe;
            _flail;
            _glaive;
            _greataxe;
            _greatsword;
            _halberd;
            _lance;
            _longsword;
            _maul;
            _morningstar;
            _pike;
            _rapier;
            _scimitar;
            _shortsword;
            _trident;
            _warPick;
            _warhammer;
            _whip;

            _blowgun;
            _crossbowHand;
            _crossbowHeavy;
            _longbow;
            _net;

            _simple;
            _martial;

            // Properties

            get () { return this. };
            set (bool) {this. = bool};
        }

        class ArmorProficiencies {
            // Fields

            _light;
            _medium;
            _heavy;
            _shields;
        }

        class ToolProficiencies {

        }
    </script>

    <!-- Handle opening a file and loading into localstorage -->

    <script>
        let content = document.getElementById("content");

        let open = document.getElementById("open");
        open.addEventListener("click", () => {
            document.body.appendChild(new OpenModal());
        }, false);
    </script>

    <script>
        class OpenModal extends HTMLElement {
            constructor() {
                super();

                let shadow = this.attachShadow({mode: 'open'});

                let style = document.createElement('style');
                style.textContent = `
                    :host {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        height: auto;
                        width: auto;
                        transform: translate(-50%, -50%);
                        border: 1px solid black;
                        padding: 10px;
                    }
                `;

                shadow.appendChild(style);

                let localText = document.createElement('h3');
                localText.appendChild(document.createTextNode("Load a saved character from localStorage..."));

                shadow.appendChild(localText);

                let importText = document.createElement('h3');
                importText.appendChild(document.createTextNode("...or import a JSON file..."));

                shadow.appendChild(importText);

                let importFile = document.createElement('input');
                importFile.type = "file";
                importFile.id = "file-input"
                importFile.onchange = e => {
                    let file = e.target.files[0];

                    if (!file) { return; }

                    let reader = new FileReader();
                    reader.readAsText(file,'UTF-8');

                    reader.onload = readerEvent => {
                        let text = readerEvent.target.result;

                        let newCharacter = new Character(JSON.parse(text));

                        let target = document.getElementById("content");
                        
                        console.log(newCharacter);

                        this.remove();
                    }
                }

                shadow.appendChild(importFile);

                let cancelText = document.createElement('h3');
                cancelText.appendChild(document.createTextNode("...or close this window."));

                shadow.appendChild(cancelText);

                let closeButton = document.createElement('button');
                closeButton.type = "button";
                closeButton.appendChild(document.createTextNode("Close"));
                closeButton.onclick = () => {
                    this.remove();
                };

                shadow.appendChild(closeButton);
            }
        }

        customElements.define("open-modal", OpenModal);
    </script>
</html>