<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
        <style>
            body {
                display: grid;
                height: 100vh;
                width: 100vw;
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
                margin: 0px;
            }

            #menu {
                grid-column: 1;
                grid-row: 1;
                height: 100%;
                width: 100%;
                margin: 0px;
                padding: 5px;
                list-style: none;
                font-size: 1.5em;
            }

            #menu li {
                display: inline-block;
            }

            #menu li #file-input {
                display: none;
            }

            #content {
                grid-column: 1;
                grid-row: 2;
            }
        </style>
    </head>
    <body>
        <ul id="menu">
            <li id="new" title="New Character">&#x1F4C4;</li>
            <li id="open" title="Load Character">&#x1F4C2;</li>
            <li id="save" title="Save Character">&#x1F4BE;</li>
        </ul>
        <div id="content"></div>
    </body>

    <script>
        class Character {
            _name;
            _race;
            _classes;
            _characterLevel = 0;
            _abilityScores;

            get Name() { return this._name; }
            set Name(name) { this._name = name; }

            get Race() { return this._race; }
            set Race(race) { this._race = race };

            get Classes() { return this._classes; }
            set Classes(obj) { this._classes = obj; }

            get CharacterLevel() { return this._characterLevel; }
            set CharacterLevel(level) { this._characterLevel = level; }

            get AbilityScores() { return this._abilityScores; }
            set AbilityScores(obj) { this._abilityScores = obj };

            // Methods

            TotalLevels() {
                let total = 0;

                for (let key in this._classes) {
                    total = total + this._classes[key];
                }

                return total;
            }

            Modifer(stat) {
                let modifier = Math.floor((stat - 10) / 2);

                if (modifier > 0) {
                    return `+${modifier}`;
                } else {
                    return modfier;
                }
            }

            constructor(json) {
                if(json) {
                    this.Name = json["Name"];
                    this.Race = json["Race"];
                    this.Classes = new ClassLevels(json["Classes"]);
                    this.CharacterLevel = this.TotalLevels();
                    this.AbilityScores = new AbilityScores(json["Ability Scores"]);
                }
            }
        }

        class ClassLevels {
            // Fields

            _artificer = 0;
            _barbarian = 0;
            _bard = 0;
            _cleric = 0;
            _fighter = 0;
            _monk = 0;
            _paladin = 0;
            _ranger = 0;
            _rouge = 0;
            _sorcerer = 0;
            _warlock = 0;
            _wizard = 0;

            // Properties

            get Artificer() { return this._artificer; }
            set Artificer(level) { this._artificer = level; }

            get Barbarian() { return this._barbarian; }
            set Barbarian(level) { this._barbarian = level; } 

            get Bard() { return this._bard; }
            set Bard(level) { this._bard = level; } 

            get Cleric() { return this._cleric; }
            set Cleric(level) { this._cleric = level; } 

            get Fighter() { return this._fighter; }
            set Fighter(level) { this._fighter = level; } 

            get Monk() { return this._monk; }
            set Monk(level) { this._monk = level; } 

            get Paladin() { return this._paladin; }
            set Paladin(level) { this._paladin = level; } 

            get Ranger() { return this._ranger; }
            set Ranger(level) { this._ranger = level; } 

            get Rouge() { return this._rouge; }
            set Rouge(level) { this._rouge = level; } 

            get Sorcerer() { return this._sorcerer; }
            set Sorcerer(level) { this._sorcerer = level; } 

            get Warlock() { return this._warlock; }
            set Warlock(level) { this._warlock = level; } 

            get Wizard() { return this._wizard; }
            set Wizard(level) { this._wizard = level; } 

            constructor(json) {
                this.Artificer = json["Artificer"];
                this.Barbarian = json["Barbarian"];
                this.Bard = json["Bard"];
                this.Cleric = json["Cleric"];
                this.Fighter = json["Fighter"];
                this.Monk = json["Monk"];
                this.Paladin = json["Paladin"];
                this.Ranger = json["Ranger"];
                this.Rouge = json["Rouge"];
                this.Sorcerer = json["Sorcerer"];
                this.Warlock = json["Warlock"];
                this.Wizard = json["Wizard"];
            }
        }

        class AbilityScores {
            // Fields

            _strength = 0;
            _dexterity = 0;
            _constituion = 0;
            _wisdom = 0;
            _intelligence = 0;
            _charisma = 0;

            // Properties

            get Strength() { return this._strength; }
            set Strength(int) { this._strength = int; }

            get Dexterity() { return this._dexterity; }
            set Dexterity(int) { this._dexterity = int; }

            get Constituion() { return _constituion; }
            set Constituion(int) { this._constituion = int; }

            get Wisdom() { return this._wisdom; }
            set Wisdom(int) { this._wisdom = int; }

            get Intelligence() { return this._intelligence; }
            set Intelligence(int) { this._intelligence = int; }

            get Charisma() { return this._charisma; }
            set Charisma(int) { this._charisma = int; }

            // Methods

            constructor(json) {
                this.Strength = json["Strength"];
                this.Dexterity = json["Dexterity"];
                this.Constituion = json["Constitution"];
                this.Wisdom = json["Wisdom"];
                this.Intelligence = json["Intelligence"];
                this.Charisma = json["Charisma"];
            }
            
        }
    </script>

    <script>
        let content = document.getElementById("content");

        let open = document.getElementById("open");
        open.addEventListener("click", () => {
            document.body.appendChild(new OpenModal());
        }, false);
    </script>

    <script>
        class OpenModal extends HTMLElement {
            constructor() {
                super();

                let shadow = this.attachShadow({mode: 'open'});

                let style = document.createElement('style');
                style.textContent = `
                    :host {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        height: auto;
                        width: auto;
                        transform: translate(-50%, -50%);
                        border: 1px solid black;
                        padding: 10px;
                    }
                `;

                shadow.appendChild(style);

                let localText = document.createElement('h3');
                localText.appendChild(document.createTextNode("Load a saved character from localStorage..."));

                shadow.appendChild(localText);

                let importText = document.createElement('h3');
                importText.appendChild(document.createTextNode("...or import a JSON file..."));

                shadow.appendChild(importText);

                let importFile = document.createElement('input');
                importFile.type = "file";
                importFile.id = "file-input"
                importFile.onchange = e => {
                    let file = e.target.files[0];

                    if (!file) { return; }

                    let reader = new FileReader();
                    reader.readAsText(file,'UTF-8');

                    reader.onload = readerEvent => {
                        let text = readerEvent.target.result;

                        let newCharacter = new Character(JSON.parse(text));

                        let target = document.getElementById("content");
                        
                        console.log(newCharacter);

                        this.remove();
                    }
                }

                shadow.appendChild(importFile);

                let cancelText = document.createElement('h3');
                cancelText.appendChild(document.createTextNode("...or close this window."));

                shadow.appendChild(cancelText);

                let closeButton = document.createElement('button');
                closeButton.type = "button";
                closeButton.appendChild(document.createTextNode("Close"));
                closeButton.onclick = () => {
                    this.remove();
                };

                shadow.appendChild(closeButton);
            }
        }

        customElements.define("open-modal", OpenModal);
    </script>
</html>