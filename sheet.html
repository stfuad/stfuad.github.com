<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
        <style>
            body {
                display: grid;
                height: calc(100vh - 16px);
                width: calc(100vw - 16px);
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
            }

            #menu {
                grid-column: 1;
                grid-row: 1;
                height: 100%;
                width: 100%;
                margin: 0px;
                padding: 5px;
                list-style: none;
                font-size: 1.5em;
            }

            #menu li {
                display: inline-block;
            }

            #menu li #file-input {
                display: none;
            }

            #content {
                grid-column: 1;
                grid-row: 2;
            }
        </style>
    </head>
    <body>
        <ul id="menu">
            <li id="new" title="New Character">&#x1F4C4;</li>
            <li id="open" title="Load Character">&#x1F4C2;</li>
            <li id="save" title="Save Character">&#x1F4BE;</li>
        </ul>
        <div id="content"></div>
    </body>

    <!-- Build a Character Object -->

    <script>
        class Character {
            _name;
            _race;
            _classes;
            _characterLevel = 0;
            _abilityScores;

            get Name() { return this._name; }
            set Name(name) { this._name = name; }

            get Race() { return this._race; }
            set Race(race) { this._race = race };

            get Classes() { return this._classes; }
            set Classes(obj) { this._classes = obj; }

            get CharacterLevel() { return this._characterLevel; }
            set CharacterLevel(level) { this._characterLevel = level; }

            get AbilityScores() { return this._abilityScores; }
            set AbilityScores(obj) { this._abilityScores = obj };

            // Methods

            TotalLevels() {
                let total = 0;

                for (let key in this._classes) {
                    total = total + this._classes[key];
                }

                return total;
            }

            Modifer(stat) {
                let modifier = Math.floor((stat - 10) / 2);

                if (modifier > 0) {
                    return `+${modifier}`;
                } else {
                    return modfier;
                }
            }

            constructor(json) {
                if(json) {
                    this.Name = json["Name"];
                    this.Race = json["Race"];
                    this.Classes = new ClassLevels(json["Classes"]);
                    this.CharacterLevel = this.TotalLevels();
                    this.AbilityScores = new AbilityScores(json["Ability Scores"]);
                }
            }
        }

        class ClassLevels {
            _artificer = 0;
            _barbarian = 0;
            _bard = 0;
            _cleric = 0;
            _fighter = 0;
            _monk = 0;
            _paladin = 0;
            _ranger = 0;
            _rouge = 0;
            _sorcerer = 0;
            _warlock = 0;
            _wizard = 0;

            get Artificer() { return this._artificer; }
            set Artificer(int) { this._artificer = int; }

            get Barbarian() { return this._barbarian; }
            set Barbarian(int) { this._barbarian = int; } 

            get Bard() { return this._bard; }
            set Bard(int) { this._bard = int; } 

            get Cleric() { return this._cleric; }
            set Cleric(int) { this._cleric = int; } 

            get Fighter() { return this._fighter; }
            set Fighter(int) { this._fighter = int; } 

            get Monk() { return this._monk; }
            set Monk(int) { this._monk = int; } 

            get Paladin() { return this._paladin; }
            set Paladin(int) { this._paladin = int; } 

            get Ranger() { return this._ranger; }
            set Ranger(int) { this._ranger = int; } 

            get Rouge() { return this._rouge; }
            set Rouge(int) { this._rouge = int; } 

            get Sorcerer() { return this._sorcerer; }
            set Sorcerer(int) { this._sorcerer = int; } 

            get Warlock() { return this._warlock; }
            set Warlock(int) { this._warlock = int; } 

            get Wizard() { return this._wizard; }
            set Wizard(int) { this._wizard = int; } 

            constructor(json) {
                if (json) {
                    this.Artificer = json["Artificer"];
                    this.Barbarian = json["Barbarian"];
                    this.Bard = json["Bard"];
                    this.Cleric = json["Cleric"];
                    this.Fighter = json["Fighter"];
                    this.Monk = json["Monk"];
                    this.Paladin = json["Paladin"];
                    this.Ranger = json["Ranger"];
                    this.Rouge = json["Rouge"];
                    this.Sorcerer = json["Sorcerer"];
                    this.Warlock = json["Warlock"];
                    this.Wizard = json["Wizard"];                    
                }
            }
        }

        class AbilityScores {
            _strength = 0;
            _dexterity = 0;
            _constituion = 0;
            _wisdom = 0;
            _intelligence = 0;
            _charisma = 0;

            get Strength() { return this._strength; }
            set Strength(int) { this._strength = int; }

            get Dexterity() { return this._dexterity; }
            set Dexterity(int) { this._dexterity = int; }

            get Constituion() { return this._constituion; }
            set Constituion(int) { this._constituion = int; }

            get Wisdom() { return this._wisdom; }
            set Wisdom(int) { this._wisdom = int; }

            get Intelligence() { return this._intelligence; }
            set Intelligence(int) { this._intelligence = int; }

            get Charisma() { return this._charisma; }
            set Charisma(int) { this._charisma = int; }

            constructor(json) {
                if (json) {
                    this.Strength = json["Strength"];
                    this.Dexterity = json["Dexterity"];
                    this.Constituion = json["Constitution"];
                    this.Wisdom = json["Wisdom"];
                    this.Intelligence = json["Intelligence"];
                    this.Charisma = json["Charisma"];                    
                }
            }
        }

        class Skills {
            _acrobatics = false;
            _animalHandling = false;
            _arcana = false;
            _athletics = false;
            _deception = false;
            _history = false;
            _insight = false;
            _intimidation = false;
            _investigation = false;
            _medicine = false;
            _nature = false;
            _perception = false;
            _performance = false;
            _persuasion = false;
            _religon = false;
            _sleightofHand = false;
            _stealth = false;
            _survival = false;

            get Acrobatics() { return this._acrobatics };
            set Acrobatics(bool) { this._acrobatics = bool };

            get AnimalHandling() { return this._animalHandling };
            set AnimalHandling(bool) { this._animalHandling = bool };
            
            get Arcana() { return this._arcana };
            set Arcana(bool) { this._arcana = bool };
            
            get Athletics() { return this._athletics };
            set Athletics(bool) { this._athletics = bool };
            
            get Deception() { return this._deception };
            set Deception(bool) { this._deception = bool };
            
            get History() { return this._history };
            set History(bool) { this._history = bool };
            
            get Insight() { return this._insight };
            set Insight(bool) { this._insight = bool };
            
            get Intimidation() { return this._intimidation };
            set Intimidation(bool) { this._intimidation = bool };
            
            get Investigation() { return this._investigation };
            set Investigation(bool) { this._investigation = bool };
            
            get Medicine() { return this._medicine };
            set Medicine(bool) { this._medicine = bool };
            
            get Nature() { return this._nature };
            set Nature(bool) { this._nature = bool };
            
            get Perception() { return this._perception };
            set Perception(bool) { this._perception = bool };
            
            get Performance() { return this._performance };
            set Performance(bool) { this._performance = bool };
            
            get Persuasion() { return this._persuasion };
            set Persuasion(bool) { this._persuasion = bool };
            
            get Religon() { return this._religon };
            set Religon(bool) { this._religon = bool };
            
            get SleightofHand() { return this._sleightofHand };
            set SleightofHand(bool) { this._sleightofHand = bool };
            
            get Stealth() { return this._stealth };
            set Stealth(bool) { this._survival = bool };
            
            get Survival() { return this._survival };
            set Survival(bool) { this._survival = bool };

            constructor(json) {
                if (json) {
                    this.Acrobatics = json["Acrobatics"];
                    this.AnimalHandling = json["Animal Handling"];
                    this.Arcana = json["Arcana"];
                    this.Athletics = json["Athletics"];
                    this.Deception = json["Deception"];
                    this.History = json["History"];
                    this.Insight = json["Insight"];
                    this.Intimidation = json["Intimidation"];
                    this.Investigation = json["Investigation"];
                    this.Medicine = json["Medicine"];
                    this.Nature = json["Nature"];
                    this.Perception = json["Perception"];
                    this.Performance = json["Performance"];
                    this.Persuasion = json["Persuasion"];
                    this.Religon = json["Religon"];
                    this.SleightofHand = json["Sleight of Hand"];
                    this.Stealth = json["Stealth"];
                    this.Survival = json["Survival"];                    
                }
            }
        }

        class SavingThrows {
            _strength = false;
            _dexterity = false;
            _constituion = false;
            _wisdom = false;
            _intelligence = false;
            _charisma = false;

            get Strength() { return this._strength; }
            set Strength(bool) { this._strength = bool; }

            get Dexterity() { return this._dexterity; }
            set Dexterity(bool) { this._dexterity = bool; }

            get Constituion() { return this._constituion; }
            set Constituion(bool) { this._constituion = bool; }

            get Wisdom() { return this._wisdom; }
            set Wisdom(bool) { this._wisdom = bool; }

            get boolelligence() { return this._boolelligence; }
            set boolelligence(bool) { this._boolelligence = bool; }

            get Charisma() { return this._charisma; }
            set Charisma(bool) { this._charisma = bool; }

            constructor(json) {
                if (json) {
                    this.Strength = json["Strength"];
                    this.Dexterity = json["Dexterity"];
                    this.Constituion = json["Constitution"];
                    this.Wisdom = json["Wisdom"];
                    this.Intelligence = json["Intelligence"];
                    this.Charisma = json["Charisma"];                    
                }
            }
        }

        class WeaponProficiencies {
            _club = false;
            _dagger = false;
            _greatclub = false;
            _handaxe = false;
            _javelin = false;
            _lightHammer = false;
            _mace = false;
            _quarterstaff = false;
            _sickle = false;
            _spear = false;
            _unarmedStrike = false;
            _crossbowLight = false;
            _dart = false;
            _shortbow = false;
            _sling = false;
            _battleaxe = false;
            _flail = false;
            _glaive = false;
            _greataxe = false;
            _greatsword = false;
            _halberd = false;
            _lance = false;
            _longsword = false;
            _maul = false;
            _morningstar = false;
            _pike = false;
            _rapier = false;
            _scimitar = false;
            _shortsword = false;
            _trident = false;
            _warPick = false;
            _warhammer = false;
            _whip = false;
            _blowgun = false;
            _crossbowHand = false;
            _crossbowHeavy = false;
            _longbow = false;
            _net = false;
            _improvised = false;
            _simple = false;
            _martial = false;
            _all = false;

            get Club() { return this._club };
            set Club(bool) { this._club = bool };

            get Dagger() { return this._dagger };
            set Dagger(bool) { this._dagger = bool };

            get Greatclub() { return this._greatclub };
            set Greatclub(bool) { this._greatclub = bool };
            
            get Handaxe() { return this._handaxe };
            set Handaxe(bool) { this._handaxe = bool };

            get Javelin() { return this._javelin };
            set Javelin(bool) { this._javelin = bool };
            
            get LightHammer() { return this._lightHammer };
            set LightHammer(bool) { this._lightHammer = bool };
            
            get Mace() { return this._mace };
            set Mace(bool) { this._mace = bool };
            
            get Quarterstaff() { return this._quarterstaff };
            set Quarterstaff(bool) { this._quarterstaff = bool };
            
            get Javelin() { return this._javelin };
            set Javelin(bool) { this._javelin = bool };
            
            get Sickle() { return this._sickle };
            set Sickle(bool) { this._sickle = bool };
            
            get Spear() { return this._spear };
            set Spear(bool) { this._spear = bool };
            
            get UnarmedStrike() { return this._unarmedStrike };
            set UnarmedStrike(bool) { this._unarmedStrike = bool };
            
            get CrossbowLight() { return this._crossbowLight };
            set CrossbowLight(bool) { this._crossbowLight = bool };
            
            get Dart() { return this._dart };
            set Dart(bool) { this._dart = bool };
            
            get Shortbow() { return this._shortbow };
            set Shortbow(bool) { this._shortbow = bool };
            
            get Sling() { return this._sling };
            set Sling(bool) { this._sling = bool };
            
            get Battleaxe() { return this._battleaxe };
            set Battleaxe(bool) { this._battleaxe = bool };
            
            get Flail() { return this._flail };
            set Flail(bool) { this._flail = bool };
            
            get Glaive() { return this._glaive };
            set Glaive(bool) { this._glaive = bool };
            
            get Greataxe() { return this._greataxe };
            set Greataxe(bool) { this._greataxe = bool };
            
            get Greatsword() { return this._greatsword };
            set Greatsword(bool) { this._greatsword = bool };
            
            get Halberd() { return this._halberd };
            set Halberd(bool) { this._halberd = bool };
            
            get Lance() { return this._lance };
            set Lance(bool) { this._lance = bool };
            
            get Longsword() { return this._longsword };
            set Longsword(bool) { this._longsword = bool };
            
            get Maul() { return this._maul };
            set Maul(bool) { this._maul = bool };
            
            get Morningstar() { return this._morningstar };
            set Morningstar(bool) { this._morningstar = bool };
            
            get Pike() { return this._pike };
            set Pike(bool) { this._pike = bool };
            
            get Rapier() { return this._rapier };
            set Rapier(bool) { this._rapier = bool };
            
            get Scimitar() { return this._scimitar };
            set Scimitar(bool) { this._scimitar = bool };
            
            get Shortsword() { return this._shortsword };
            set Shortsword(bool) { this._shortsword = bool };
            
            get Trident() { return this._trident };
            set Trident(bool) { this._trident = bool };
            
            get WarPick() { return this._warPick };
            set WarPick(bool) { this._warPick = bool };
            
            get Warhammer() { return this._warhammer };
            set Warhammer(bool) { this._warhammer = bool };
            
            get Whip() { return this._whip };
            set Whip(bool) { this._whip = bool };
            
            get Blowgun() { return this._blowgun };
            set Blowgun(bool) { this._blowgun = bool };
            
            get CrossbowHand() { return this._crossbowHand };
            set CrossbowHand(bool) { this._crossbowHand = bool };
            
            get CrossbowHeavy() { return this._crossbowHeavy };
            set CrossbowHeavy(bool) { this._crossbowHeavy = bool };
            
            get Longbow() { return this._longbow };
            set Longbow(bool) { this._longbow = bool };
            
            get Net() { return this._net };
            set Net(bool) { this._net = bool };
            
            get Improvised() { return this._improvised };
            set Improvised(bool) { this._improvised = bool };
            
            get Simple() { return this._simple };
            set Simple(bool) { this._simple = bool };
            
            get Martial() { return this._martial };
            set Martial(bool) { this._martial = bool };
            
            get All() { return this._all };
            set All(bool) { this._all = bool };

            constructor(json) {
                if (json) {
                    this.Club = json["Club"];
                    this.Dagger = json["Dagger"];
                    this.Greatclub = json["Greatclub"];
                    this.Handaxe = json["Handaxe"];
                    this.Javelin = json["Javelin"];
                    this.LightHammer = json["Light Hammer"];
                    this.Mace = json["Mace"];
                    this.Quarterstaff = json["Quarterstaff"];
                    this.Sickle = json["Sickle"];
                    this.Spear = json["Spear"];
                    this.UnarmedStrike = json["Unarmed Strike"];
                    this.CrossbowLight = json["Crossbow Light"];
                    this.Dart = json["Dart"];
                    this.Shortbow = json["Shortbow"];
                    this.Sling = json["Sling"];
                    this.Battleaxe = json["Battleaxe"];
                    this.Flail = json["Flail"];
                    this.Glaive = json["Glaive"];
                    this.Greataxe = json["Greataxe"];
                    this.Greatsword = json["Greatsword"];
                    this.Halberd = json["Halberd"];
                    this.Lance = json["Lance"];
                    this.Longsword = json["Longsword"];
                    this.Maul = json["Maul"];
                    this.Morningstar = json["Morningstar"];
                    this.Pike = json["Pike"];
                    this.Rapier = json["Rapier"];
                    this.Scimitar = json["Scimitar"];
                    this.Shortsword = json["Shortsword"];
                    this.Trident = json["Trident"];
                    this.WarPick = json["War Pick"];
                    this.Warhammer = json["Warhammer"];
                    this.Whip = json["Whip"];
                    this.Blowgun = json["Blowgun"];
                    this.CrossbowHand = json["Crossbow Hand"];
                    this.CrossbowHeavy = json["Crossbow Heavy"];
                    this.Longbow = json["Longbow"];
                    this.Net = json["Net"];
                    this.Improvised = json["Improvised"];
                    this.Simple = json["Simple"];
                    this.Martial = json["Martial"];
                    this.All = json["All"];
                }
            }
        }

        class ArmorProficiencies {
            _light = false;
            _medium = false;
            _heavy = false;
            _shields = false;
            _all = false;

            get Light() { return this._light; }
            set Light(bool) { this._light = bool; }

            get Medium() { return this._medium; }
            set Medium(bool) { this._medium = bool; }

            get Heavy() { return this._heavy; }
            set Heavy(bool) { this._heavy = bool; }

            get Shields() { return this._shields; }
            set Shields(bool) { this._shields = bool; }

            get All() { return this._all; }
            set All(bool) { this._all = bool; }

            constructor(json) {
                if (json) {
                    this.Light = json["Light"];
                    this.Medium = json["Medium"];
                    this.Heavy = json["Heavy"];
                    this.All = json["All"]
                }
            }
        }

    </script>

    <!-- Handle opening a file and loading into localstorage -->

    <script>
        let content = document.getElementById("content");

        let open = document.getElementById("open");
        open.addEventListener("click", () => {
            document.body.appendChild(new OpenModal());
        }, false);
    </script>

    <script>
        class OpenModal extends HTMLElement {
            constructor() {
                super();

                let shadow = this.attachShadow({mode: 'open'});

                let style = document.createElement('style');
                style.textContent = `
                    :host {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        height: auto;
                        width: auto;
                        transform: translate(-50%, -50%);
                        border: 1px solid black;
                        padding: 10px;
                    }
                `;

                shadow.appendChild(style);

                let localText = document.createElement('h3');
                localText.appendChild(document.createTextNode("Load a saved character from localStorage..."));

                shadow.appendChild(localText);

                let importText = document.createElement('h3');
                importText.appendChild(document.createTextNode("...or import a JSON file..."));

                shadow.appendChild(importText);

                let importFile = document.createElement('input');
                importFile.type = "file";
                importFile.id = "file-input"
                importFile.onchange = e => {
                    let file = e.target.files[0];

                    if (!file) { return; }

                    let reader = new FileReader();
                    reader.readAsText(file,'UTF-8');

                    reader.onload = readerEvent => {
                        let text = readerEvent.target.result;

                        let newCharacter = new Character(JSON.parse(text));

                        let target = document.getElementById("content");
                        
                        console.log(newCharacter);

                        this.remove();
                    }
                }

                shadow.appendChild(importFile);

                let cancelText = document.createElement('h3');
                cancelText.appendChild(document.createTextNode("...or close this window."));

                shadow.appendChild(cancelText);

                let closeButton = document.createElement('button');
                closeButton.type = "button";
                closeButton.appendChild(document.createTextNode("Close"));
                closeButton.onclick = () => {
                    this.remove();
                };

                shadow.appendChild(closeButton);
            }
        }

        customElements.define("open-modal", OpenModal);
    </script>
</html>