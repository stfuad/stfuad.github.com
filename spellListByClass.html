<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <title>5e Spells by Class</title>

        <link rel="stylesheet" href="stylesheets/gridLayout.css">

        <style>
            body {
                grid-template-columns: 300px 300px auto;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
            }

            a {
                text-decoration: none; 
            }

            #header {
                grid-column: 1/4;
                grid-row: 1;
            }

            #list {
                grid-column: 2;
                grid-row: 2/4;
                max-height: calc(100vh - 110px);
                overflow: auto;
            }

            #content {
                grid-column: 3;
                grid-row: 2/4;
                overflow: auto;
            }

            ul {
                list-style: none;
            }
        </style>
    </head>

    <body>
        <div id="header">
            <h1>5e Spells by Class</h1>
        </div>

        <div id="topNav"></div>

        <div id="pageNav"></div>

        <div id="list"></div>
        <div id="content"></div>

        <script src="./scripts/global.js"></script>
        <script>
            fetch("./topNav.html")
                .then(response => response.text())
                .then(data => {
                    let target = document.querySelector("#topNav");

                    target.innerHTML = data;
                })
            fetch("./json/5e Data.json")
                .then(response => response.json())
                .then(json => {
                    for(let key in json) {
                        localStorage.setItem(key, JSON.stringify(json[key]));
                    }
                })
                .then(() => {
                    let spellList = JSON.parse(localStorage.getItem("Spell List"));
                    let spells = JSON.parse(localStorage.getItem("Spells"));

                    for(let key in spellList) {
                        let h2 = InsertElement('h2', key, list);

                        let link1 = InsertElement('h3', key, pageNav);

                        for(let level in spellList[key]) {
                            let length = spellList[key][level].length;

                            if(length >= 1) {
                                let h3 = InsertElement('h3', level, list);
                                h3.id = `${key} ${level}`;

                                let link2 = InsertElement('a', `- ${level}`, pageNav);
                                link2.href = `#${key} ${level}`;

                                let ul = document.createElement('ul');

                                let sorted = spellList[key][level].sort();

                                sorted.forEach(element => {
                                    let spellJSON = JSON.stringify(spells[element])

                                    let li = InsertElement('li', undefined, ul);
                                    
                                    let a = InsertElement('a', element, li)
                                    a.href = `javascript:Sheet("${element}", ${spellJSON})`;
                                });

                                list.appendChild(ul);                        
                            }
                        } 
                    }
                })

            function Sheet(name, json) {
                let cont = document.querySelector("#content");
                cont.innerHTML = "";

                let h1 = InsertElement('h1', name, cont);

                // School, cantrip, ritual, level
                let subTitle = document.createElement('i');
                cont.appendChild(subTitle);

                let scrl = "";

                let school = json["School"];
                let cantrip = json["Cantrip"];
                let ritual = json["Ritual"];
                let level = json["Level"];

                if(level === 0) {
                    level = "";
                } else if(level === 1) {
                    level = "1st-level";
                } else if(level === 2) {
                    level = "2nd-level";
                } else if(level === 3) {
                    level = "3rd-level";
                } else if(level >= 4) {
                    level = `${level}th-level`;
                }

                scrl = `${level} ${school}`;

                if(cantrip == true) {
                    scrl += " cantrip";
                }

                if(ritual == true) {
                    scrl += " (ritual)";
                }

                subTitle.appendChild(document.createTextNode(scrl));

                KeyValue(json, cont, "Casting Time", "Range", "Components", "Duration");

                for(let key in json) {
                    if(key.includes("Description") || key == "Higher Levels") {
                        Paragraphs(json[key], cont);
                    } else if(key.includes("Unordered List")) {
                        List(json[key], "ul", cont);
                    } else if(key.includes("Ordered List")) {
                        List(json[key], "ol", cont);
                    } else if(key.includes("Table")) {
                        Table(json[key], cont)
                    }
                }

                InsertElement("i", `${json["Book"]}, Pg. ${json["Page"]}`, cont);
            }

            function KeyValue(json, parent, ...keys) {
                keys.forEach(key => {
                    if(def(json[key])) {
                        let div = document.createElement('div');

                        let b = document.createElement('b');
                        b.appendChild(document.createTextNode(`${key} `))
                        div.appendChild(b);

                        div.appendChild(document.createTextNode(json[key]));

                        parent.appendChild(div);
                    }
                });
            }
        </script>
    </body>
</html>